#!/bin/bash -x

. ./send_dtmf.sh
echo $0
echo $(dirname $0)
ACFILE=$(dirname $0)/access
if [ -s ${ACFILE} ]; then
   ACCESS=$(cat ${ACFILE})
else
   echo "no access file"
   exit 1
fi

setup_gb3wx()
{
# access
send_dtmf ${ACCESS} access

send_dtmf *0061 "rx1->tx1_ena"
send_dtmf *0071 "rx1->tx2_ena"
send_dtmf *0261 "rx2->tx1_ena"
send_dtmf *0271 "rx2->tx2_ena"

#
# courtesy tones are enabled by default on both transmitters
# see page 36 4.5 and page 37 4.6
#
send_dtmf *0461
send_dtmf *0471
send_dtmf *0561
send_dtmf *0571

#
# courtesy tone programming
# TODO
# change once we figure out what's going on
#
#send_dtmf *7109931 R1T1-CT-D
#send_dtmf *7119952 R1T2-CT-K
#send_dtmf *7129953 R2T1-CT-L
#send_dtmf *7139932 R2T2-CT-E

#t1=0512051505190522

# DADG
t1=0522051705100503

# F# D F# D
#t2=0514051005140510

# CGEC
#20 15 12 8
t2=0520051505120508

# ADAD
# 17 22 17 10

send_dtmf *710${t1}
send_dtmf *711${t2}
send_dtmf *712${t1}
send_dtmf *713${t2}

#
# save settings
# 0 is the power up group
#
send_dtmf \*10

#
# load power up settings
#
send_dtmf \*\*

#
# Wait for the initial annoucement of firmaware version etc.
#
sleep 5

# 
#
# leave privileged mode
#
send_dtmf \# quit

#
# link state routing sec 5.4 link state control
# NOTE this is a user command and must be done
# in a non-privileged state
#
send_dtmf 0433

}

setup_gb3wx
